name: YouTube Video Linker

on:
  workflow_dispatch:
    inputs:
      pattern_path:
        description: 'Pattern folder path (e.g., dataweave/patterns/01-array-manipulation)'
        required: true
      youtube_url:
        description: 'YouTube video URL'
        required: true
      video_title:
        description: 'Video title for the badge'
        required: true

jobs:
  link-video:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Add YouTube badge to pattern README
        run: |
          PATTERN_DIR="${{ github.event.inputs.pattern_path }}"
          VIDEO_URL="${{ github.event.inputs.youtube_url }}"
          VIDEO_TITLE="${{ github.event.inputs.video_title }}"
          README_PATH="${PATTERN_DIR}/README.md"

          if [ ! -f "$README_PATH" ]; then
            echo "README not found at $README_PATH"
            exit 1
          fi

          # Add YouTube badge after the first heading
          BADGE="[![YouTube](https://img.shields.io/badge/YouTube-Watch-red.svg)](${VIDEO_URL})"
          sed -i "0,/^#/{/^#/a\\
          ${BADGE}
          }" "$README_PATH"

          echo "Added YouTube badge to $README_PATH"

      - name: Commit changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git diff --staged --quiet || git commit -m "Link YouTube video to ${{ github.event.inputs.pattern_path }}"
          git push
